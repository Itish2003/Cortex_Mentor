name: Integration Tests
on: [pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    services:
      redis:
        image: redis:7-alpine
        ports:
          - 6379:6379
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
      - name: Install uv
        run: pip install uv
      - name: Install dependencies
        run: uv pip install -e .[dev]
      - name: Start backend server
        run: |
          uv run uvicorn src.cortex.main:app --host 0.0.0.0 --port 8000 &
          sleep 5 # Give the server some time to start
      - name: Start ARQ worker
        run: |
          uv run arq src.cortex.workers.WorkerSettings &
          sleep 5 # Give the worker some time to start
      - name: Run end-to-end workflow tests
        run: echo "TODO: Run end-to-end workflow tests"
      - name: Verify WebSocket communication
        run: echo "TODO: Verify WebSocket communication"
